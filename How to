Что за кластер??

В целом ,кластер это группа компьютеров ,которая выступает единым целым.
В конечном счёте нам нужно заставить их работать так ,для большей производительности и удобства.
Все компьютеры работают на одной задачей ,сокращая время её выполнения (поставленной задачи)

Не путайте компьютерный кластер и распределение задач.
В архитектуре распределённых задач каждый компьютер работает над задачей ,не аналогичной другому компьютеру.
В кластере же ,мы используем всю вычислительную мощь и направляем её на паралельное выполнение на каждом ядре.


Примеры кластеров 
Начали своё существование кластеры ещё в 60х и до сих пор являются широко распространёнными в сфере распределённых вычислений.
Самым первым кластером в истории был Arcnet и объединял он 2200 компьютеров.
В данный момент самый крутой кластер находится в ORNL laboratory и объединяет 2 миллиона CPU(процессор) и более 3000To RAM(оперативной памяти).

Перейдём к тому как и куда мы это сделали 
Начали с выбора платформы и пришли к тому ,что это должны быть маленькие и  производительные.
Наш выбор пал на Raspberry pi.
Начнём со списка необходимого:
1.Raspberry pi ,главная нода у нас на Pi 3 b+
2.microSD card c 10 классом обработки данных.
3.Монитор и компьютер.
4.гигабитный Ethernet-кабель(в зависимости от кол-ва ваших компьютеров)
5.Роутер или хаб для Ethernet-кабелей 

Так как мы выбрали Raspberry pi ,то далее будет инструкция именно для неё.
/////Подготовка главного ядра
Для старта нам нужно залить операционную систему на одну microSD(она есть на сайте raspberry,как и гайд по её установке)
После установки системы вставляем флешку в микрокомпьютер и ждём загрузки системы.
Как только мы загрузились открываем терминал (Ctrl+Alt+T).
Так как данная система является дистрибутивом Linux ,то всё команды ,что будут описаны далее нужно вводить именно туда.


Начнём с простой настройки нашей системы 
  Запускаем Config :
                     sudo raspi-config
            Изменяем в этом окне пароль на нужный вам.
            Далее нужно включить соединение по SSH для этого заходим в interfacing options 
            следующим шагом будет выбор имени для нашего Master-node (node - это такое наименование для обозначения ячейки как компьютера )
            там же нужно зайти в Network options>Host name и выбираем какое-то правильное имя ,чтоб не запутаться например Maste
 Оновите ввашу систему
         sudo apt update 
 Обновите все пакеты 
         sudo apt upgrade 
 Перезагружаемся 
         sudo reboot 
 
 
 
 Далее нам нужно утановить MPICH
 
 Что это такое ???
  это основной интсрумент для запуска кластеров,нужный для запуска одной задачи параллельно на нескольких нодах.
  Если по-простому то это нам нужно ,чтоб всё работало нормально.
  
  Для установки этой программы нам нужно создать 3 папки.
       sudo mkdir /opt/mpi
       sudo mkdir /opt/mpi-build
       sudo mkdir /opt/mpi-di
  После нам нужно установить Fortran для корректной работы MPICH
       sudo apt install gfortran 
   MPICH installation 
         Переходим в папку для загрузки 
         cd /opt/mpi-di
         
   Загружаем MPICH 
    sudo wget http://www.mpich.org/static/downloads/3.3/mpich-3.3.tar.gz
    Распаковываем архив
    tar zxvf mpich-3.3.tar.gz 
    После переходим в другую папку 
    cd /opt/mpi-build
    
    и делаем конфигурацию процессов 
    sudo /opt/mpi-dl/mpich-3.3/configure --prefix=/opt/mpi 
    
    Далее используйте это для сборки установочного пакета 
        sudo make 
        Это заняло на Raspberry Pi 3B+ 1,5 часа ,а на Raspberry Pi около 2
        
        И в конце 
        sudo make install  
       Это уже быстрее ,так что можно попить чаю 
       
       И для проверки используем 
       /opt/mpi/bin/mpiexec -n 1 date
       
        Если всё окей ,то мы увидем правильную дату(сегодняшнюю)
        
        MPI4PY 
        ну тут всё просто,это расширение для нашего MPICH ,чтоб мы могли работать на наших компьютерах в полную силу 
         Для начала нужно установить библиотеку python 
         sudo apt install python-pip python-dev libopenmpi-dev
         
       Приступаем 
       
         Устанавливаем MPI4PY через pip 
         sudo pip install mpi4py
          Далее сменяем дирикторию 
              cd /home/pi 
      И создаём там файл .py 
      nano test.py
    В открытом редакторе вписываем 
    print(34442)
  Проверим всё ли работает как мы хотим 
  
  python test.py
  
  Если вывело наше число ,то проверим работу в потоках 
  /opt/mpi/bin/mpiexec -n 4 python test.py
 Должно 4 раза вывести наше число.
 
 
 Создаём дубликат системы 
 Для этого нам понадобится Win32Diskimager
 Там выбираем название нашей системы и производим бэкап ,нажав кнопку READ 
  Далее как мы делали с первой системой заливаем эту на остальные microSD
  
  Для объединенпия всего в кластер идём к главной ноде и делаем это
        sudo apt install nmap
        nmap нужен для того,чтоб найти остальыне ноды в нашей сети 
        Находим адрес своей группы нод и записываем 
        nmap -sP 192.168.1.* | grep master
        
        далее создаём папку с ip адресами всех нод
        cd /home/pi
        nano nodesips
        и записываем туда всё наши ip
        
        Изменяем имена нод ,кроме главной по принципу NODE01,NODE02 и т.д.
         и для проверки запускаем 
         
        /opt/mpi/bin/mpiexec -f nodesips -n 2 hostname 
        Если всё работает ,то я вас поздравляю,вы сделали свой первый кластер!!!!
    
    
 
     
            
            
            
